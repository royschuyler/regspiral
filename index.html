<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spiral Generator with Adjustable Spacing</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fff;
      text-align: center;
      margin: 20px;
    }
    canvas {
      border: 1px solid #ccc;
      background: #fff;
      display: block;
      margin: 20px auto;
    }
    .controls {
      margin-bottom: 20px;
    }
    .control {
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>Spiral from Grid Intersections</h1>
  <div class="controls">
    <div class="control">
      <label for="nSlider">Number of Lines (n):</label>
      <input type="range" id="nSlider" min="10" max="1000" value="1000">
      <span id="nValue">100</span>
    </div>
    <div class="control">
      <label for="mSlider">Number of Circles (m):</label>
      <input type="range" id="mSlider" min="10" max="1000" value="1000">
      <span id="mValue">100</span>
    </div>
    <div class="control">
      <label for="tSlider">Total Degrees (t):</label>
      <input type="range" id="tSlider" min="10" max="2000" value="450">
      <span id="tValue">450</span>
    </div>
    <div class="control">
      <label for="spacingExpSlider">Spacing Exponent:</label>
      <input type="range" id="spacingExpSlider" min="1" max="20" step="0.25" value="1">
      <span id="spacingExpValue">1</span>
    </div>
    <div class="control">
      <button id="downloadBtn">Download Image</button>
    </div>
  </div>
  
  <canvas id="canvas" width="600" height="600"></canvas>
  
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Slider elements and their display spans.
    const nSlider = document.getElementById('nSlider');
    const mSlider = document.getElementById('mSlider');
    const tSlider = document.getElementById('tSlider');
    const spacingExpSlider = document.getElementById('spacingExpSlider');
    
    const nValue = document.getElementById('nValue');
    const mValue = document.getElementById('mValue');
    const tValue = document.getElementById('tValue');
    const spacingExpValue = document.getElementById('spacingExpValue');
    
    const downloadBtn = document.getElementById('downloadBtn');
    
    function draw() {
      // Read slider values.
      const n = parseInt(nSlider.value);
      const m = parseInt(mSlider.value);
      const t = parseFloat(tSlider.value); // total degrees
      const spacingExp = parseFloat(spacingExpSlider.value);
      
      nValue.textContent = n;
      mValue.textContent = m;
      tValue.textContent = t;
      spacingExpValue.textContent = spacingExp;
      
      // Define maximum radius as 90% of half the canvas width.
      const maxR = (canvas.width / 2) * 0.9;
      
      // Clear the canvas.
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Move origin to the center.
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      
      // Convert total degrees to radians.
      const tRad = t * Math.PI / 180;
      
      // Grid spacing: the n radial lines are at multiples of gridAngleSpacing.
      const gridAngleSpacing = 2 * Math.PI / n;
      
      // Build spiral points (using m+1 points).
      let points = [];
      for (let i = 0; i <= m; i++) {
        // Compute circle radius using a non-linear spacing function:
        // r = (i/m)^spacingExp * maxR
        const r = Math.pow(i / m, spacingExp) * maxR;
        // Ideal spiral angle (continuous)
        const thetaCont = (i / m) * tRad;
        // Snap this angle to the nearest grid angle:
        const k = Math.round(thetaCont / gridAngleSpacing);
        const snappedAngle = k * gridAngleSpacing;
        const x = r * Math.cos(snappedAngle);
        const y = r * Math.sin(snappedAngle);
        points.push({ x, y });
      }
      
      // Draw the spiral as a thin (0.5px) black line.
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 0.5;
      ctx.beginPath();
      points.forEach((pt, idx) => {
        if (idx === 0) {
          ctx.moveTo(pt.x, pt.y);
        } else {
          ctx.lineTo(pt.x, pt.y);
        }
      });
      ctx.stroke();
      
      ctx.restore();
    }
    
    // Update drawing on slider input.
    nSlider.addEventListener('input', draw);
    mSlider.addEventListener('input', draw);
    tSlider.addEventListener('input', draw);
    spacingExpSlider.addEventListener('input', draw);
    
    // Download the canvas as a PNG when the button is clicked.
    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'spiral.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
    
    // Initial drawing.
    draw();
  </script>
</body>
</html>
